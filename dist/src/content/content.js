const r="webwhiz_sticky_notes";function f(){return window.location.origin+window.location.pathname}function a(t){chrome.storage.local.get([r],i=>{const n=i[r]||{},e=f();t(n[e]||[])})}function d(t){chrome.storage.local.get([r],i=>{const n=i[r]||{},e=f();n[e]=t,chrome.storage.local.set({[r]:n})})}function y(t,i,n){const e=document.createElement("div");e.className="webwhiz-sticky-note fixed z-[99999] bg-yellow-100 dark:bg-yellow-800 text-gray-900 dark:text-gray-100 shadow-lg rounded p-2 min-w-[120px] min-h-[60px] cursor-move",e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.maxWidth="200px",e.style.position="fixed",e.setAttribute("data-id",t.id);const o=document.createElement("textarea");o.value=t.text,o.className="w-full bg-transparent outline-none resize-none text-sm",o.rows=3,o.oninput=()=>{t.text=o.value,i(t)},e.appendChild(o);const s=document.createElement("button");s.textContent="âœ•",s.className="absolute top-1 right-1 text-xs text-gray-500 hover:text-red-500",s.onclick=()=>n(t.id),e.appendChild(s);let m=0,x=0,c=!1;return e.onmousedown=l=>{l.target.tagName!=="TEXTAREA"&&(c=!0,m=l.clientX-e.offsetLeft,x=l.clientY-e.offsetTop,document.body.style.userSelect="none")},document.addEventListener("mousemove",l=>{c&&(e.style.left=l.clientX-m+"px",e.style.top=l.clientY-x+"px")}),document.addEventListener("mouseup",l=>{c&&(c=!1,t.x=e.offsetLeft,t.y=e.offsetTop,i(t),document.body.style.userSelect="")}),e}function u(t,i,n){document.querySelectorAll(".webwhiz-sticky-note").forEach(e=>e.remove()),t.forEach(e=>{const o=y(e,i,n);document.body.appendChild(o)})}function p(){a(n=>{u(n,t,i)});function t(n){a(e=>{const o=e.findIndex(s=>s.id===n.id);o!==-1&&(e[o]=n),d(e)})}function i(n){a(e=>{const o=e.filter(s=>s.id!==n);d(o),u(o,t,i)})}chrome.runtime.onMessage.addListener(n=>{if(n.type==="WEBWHIZ_ADD_NOTE"){const e={id:"note-"+Date.now(),text:"",x:window.innerWidth/2-60,y:window.innerHeight/2-30,url:f()};a(o=>{const s=[...o,e];d(s),u(s,t,i)})}})}p();
